{% extends "base.html" %}
{% set title = "Компании — Sales Journey" %}

{% block content %}
<div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3 mb-6">
  <div>
    <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">Компании</h1>
    <p class="text-sm text-[color:var(--sj-muted)] mt-1">Тут ты управляешь компаниями, сотрудниками и CRM.</p>
  </div>

  <div class="flex gap-2">
    <a href="/partner/profile"
       class="px-3 py-2 rounded-2xl bg-white/5 border border-[color:var(--sj-border)] hover:bg-white/10">
      <i class="fa-solid fa-user-gear mr-2 text-white/60"></i>Профиль
    </a>
  </div>
</div>

<div class="rounded-2xl border border-[color:var(--sj-border)] bg-white/5 p-5">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
    <div class="font-bold text-lg">Мои компании</div>
    <div class="flex gap-2">
      <input id="q" placeholder="Поиск по названию…"
             class="w-full md:w-80 px-3 py-2 rounded-2xl bg-white/5 border border-[color:var(--sj-border)] focus:outline-none focus:ring-2 focus:ring-violet-500/40"
             oninput="filterCompanies()">
    </div>
  </div>

  <div class="mt-4 grid md:grid-cols-2 gap-3" id="grid">
    {% for c in companies %}
    <a href="/partner/company/{{ c.id }}"
       class="group rounded-2xl border border-[color:var(--sj-border)] bg-black/20 hover:bg-white/5 p-5 transition"
       data-name="{{ c.name|lower }}">
      <div class="flex items-start justify-between gap-3">
        <div class="min-w-0">
          <div class="text-lg font-extrabold truncate">{{ c.name }}</div>
          <div class="text-xs text-[color:var(--sj-muted)] mt-1">ID: {{ c.id }}</div>
        </div>
        <div class="w-12 h-12 rounded-2xl bg-white/5 border border-[color:var(--sj-border)] grid place-items-center">
          <i class="fa-solid fa-building text-white/70 group-hover:text-white"></i>
        </div>
      </div>

      <div class="mt-4 flex flex-wrap gap-2">
        <span class="inline-flex items-center gap-2 px-3 py-1 rounded-2xl bg-white/5 border border-[color:var(--sj-border)]">
          <i class="fa-solid fa-ticket text-[color:var(--sj-cyan)]"></i>
          <span class="text-sm font-semibold">{{ c.invite_code }}</span>
        </span>

        <span class="inline-flex items-center gap-2 px-3 py-1 rounded-2xl bg-white/5 border border-[color:var(--sj-border)]">
          <i class="fa-solid fa-users text-white/60"></i>
          <span class="text-sm font-semibold">{{ c.employees|length }}</span>
          <span class="text-xs text-[color:var(--sj-muted)]">сотрудников</span>
        </span>

        <span class="inline-flex items-center gap-2 px-3 py-1 rounded-2xl bg-white/5 border border-[color:var(--sj-border)]">
          <i class="fa-solid fa-plug text-white/60"></i>
          <span class="text-xs text-[color:var(--sj-muted)]">CRM</span>
        </span>
      </div>

      <div class="mt-4 text-sm text-[color:var(--sj-muted)]">
        Открыть управление →
      </div>
    </a>
    {% else %}
      <div class="rounded-2xl border border-[color:var(--sj-border)] bg-black/20 p-6 text-[color:var(--sj-muted)]">
        Компаний нет. Их создаёт супер-админ и назначает партнёра.
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  function filterCompanies(){
    const q = (document.getElementById('q').value || '').trim().toLowerCase();
    const cards = document.querySelectorAll('#grid a[data-name]');
    cards.forEach(el=>{
      const name = el.getAttribute('data-name') || '';
      el.style.display = name.includes(q) ? '' : 'none';
    });
  }
</script>
{% endblock %}
