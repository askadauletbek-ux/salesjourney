{% extends "base.html" %}
{% set title = "Смена пароля — Sales Journey" %}

{% block content %}
<section class="min-h-[70vh] grid place-items-center">
  <div class="w-full max-w-lg rounded-2xl border border-[color:var(--sj-border)] bg-white/5 p-6 shadow-[var(--sj-shadow)]">
    <div class="flex items-start justify-between gap-3">
      <div>
        <h1 class="text-2xl font-extrabold tracking-tight">Смена пароля</h1>
        <p class="text-sm text-[color:var(--sj-muted)] mt-1">
          Для безопасности нужно заменить временный пароль на свой.
        </p>
      </div>
      <div class="w-12 h-12 rounded-2xl bg-white/5 border border-[color:var(--sj-border)] grid place-items-center">
        <i class="fa-solid fa-key text-[color:var(--sj-amber)] text-lg"></i>
      </div>
    </div>

    <form action="/auth/password/change" method="POST" class="mt-5 space-y-3">
      <div class="grid sm:grid-cols-2 gap-3">
        <div>
          <label class="text-sm font-medium">Новый пароль</label>
          <input type="password" name="new_password" id="np" required minlength="8"
                 class="mt-1 w-full px-3 py-2 rounded-2xl bg-white/5 border border-[color:var(--sj-border)]
                        focus:outline-none focus:ring-2 focus:ring-violet-500/40"
                 placeholder="Минимум 8 символов">
        </div>

        <div>
          <label class="text-sm font-medium">Повтори пароль</label>
          <input type="password" name="new_password2" id="np2" required minlength="8"
                 class="mt-1 w-full px-3 py-2 rounded-2xl bg-white/5 border border-[color:var(--sj-border)]
                        focus:outline-none focus:ring-2 focus:ring-violet-500/40"
                 placeholder="Повтор">
        </div>
      </div>

      <div class="rounded-2xl border border-[color:var(--sj-border)] bg-black/20 p-4 text-sm">
        <div class="flex items-center justify-between gap-3">
          <div class="text-[color:var(--sj-muted)]">Подсказка</div>
          <button type="button" class="px-3 py-2 rounded-2xl bg-white/5 border border-[color:var(--sj-border)] hover:bg-white/10 text-xs"
                  onclick="genPwd()">
            Сгенерировать
          </button>
        </div>
        <div class="mt-2 text-xs text-[color:var(--sj-muted)]">
          Используй буквы + цифры. Не используй одинаковые пароли в разных сервисах.
        </div>
      </div>

      <button type="submit"
              class="w-full py-2.5 rounded-2xl font-semibold bg-gradient-to-r from-violet-600 to-cyan-400 text-black hover:opacity-95"
              onclick="return validatePwd()">
        Сохранить и продолжить
      </button>
    </form>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  function validatePwd(){
    const a = document.getElementById('np').value;
    const b = document.getElementById('np2').value;
    if(a !== b){
      Alpine.store('toasts')?.push({title:'Ошибка', text:'Пароли не совпадают', icon:'fa-solid fa-triangle-exclamation', tone:'err'});
      return false;
    }
    return true;
  }
  function genPwd(){
    const chars = "ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789!@#$%";
    let p = "";
    for(let i=0;i<14;i++) p += chars[Math.floor(Math.random()*chars.length)];
    document.getElementById('np').value = p;
    document.getElementById('np2').value = p;
    Alpine.store('toasts')?.push({title:'Готово', text:'Пароль сгенерирован', icon:'fa-solid fa-circle-check', tone:'ok'});
  }
</script>
{% endblock %}
