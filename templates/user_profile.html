{% extends "base.html" %}
{% block content %}
<style>
    .p-card { background: var(--sj-card); border: 1px solid var(--sj-border); border-radius: 32px; padding: 40px; }
    .stat-pill { background: rgba(255,255,255,0.03); border: 1px solid var(--sj-border); border-radius: 20px; padding: 15px; text-align: center; }
</style>

<div class="max-w-4xl mx-auto py-10">
    <div class="p-card flex flex-col md:flex-row items-center gap-10">
        <div class="w-32 h-32 rounded-3xl bg-gradient-to-br from-violet-600 to-cyan-500 flex items-center justify-center text-5xl font-black text-black shadow-2xl">
            {{ target_user.username[0].toUpperCase() }}
        </div>
        <div class="flex-1 text-center md:text-left">
            <h1 class="text-4xl font-black mb-1">{{ target_user.username }}</h1>
            <p class="text-[color:var(--sj-muted)] mb-4">{{ target_user.company.name }} • {{ target_user.role.value }}</p>
            <div class="flex flex-wrap gap-4 justify-center md:justify-start">
                <div class="stat-pill">
                    <div class="text-[10px] uppercase font-bold text-[color:var(--sj-muted)]">Уровень</div>
                    <div class="text-xl font-black">{{ 1 + (target_user.gamification_profile.xp // 1000) }}</div>
                </div>
                <div class="stat-pill">
                    <div class="text-[10px] uppercase font-bold text-[color:var(--sj-muted)]">Конверсия</div>
                    <div class="text-xl font-black">{{ stats.conversion if stats else 0 }}%</div>
                </div>
                <div class="stat-pill">
                    <div class="text-[10px] uppercase font-bold text-[color:var(--sj-muted)]">Звонки</div>
                    <div class="text-xl font-black">{{ stats.calls_count if stats else 0 }}</div>
                </div>
            </div>
        </div>
        <button onclick="alert('Чат в разработке')" class="px-8 py-3 bg-white/10 rounded-2xl font-bold hover:bg-white/20 transition-all border border-white/10">Связаться</button>
    </div>

    <div class="mt-12">
        <h3 class="text-xl font-black text-white mb-6 flex items-center gap-2">
            <i class="fa-solid fa-medal text-amber-500"></i> Награды и достижения
        </h3>
        <div class="grid grid-cols-4 sm:grid-cols-6 lg:grid-cols-8 gap-4">
            {% for ua in target_user.achievements %}
            <div class="group relative flex flex-col items-center">
                <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-amber-400 to-orange-600 flex items-center justify-center text-2xl text-black shadow-lg shadow-amber-500/20 transition-transform group-hover:scale-110">
                    <i class="fa-solid {{ ua.achievement.icon_code }}"></i>
                </div>
                <div class="absolute bottom-full mb-3 opacity-0 group-hover:opacity-100 transition-opacity bg-black border border-white/10 p-3 rounded-xl text-[10px] w-40 text-center z-50 shadow-2xl pointer-events-none">
                    <div class="font-bold text-amber-500 mb-1">{{ ua.achievement.name }}</div>
                    <div class="text-white/60 leading-tight">{{ ua.achievement.description }}</div>
                    <div class="mt-2 pt-2 border-t border-white/5 text-[8px] text-white/30 uppercase">{{ ua.earned_at.strftime('%d.%m.%Y') }}</div>
                </div>
            </div>
            {% endfor %}
            {% if not target_user.achievements %}
                <div class="col-span-full py-6 text-center text-white/20 text-xs font-bold uppercase tracking-widest border border-dashed border-white/10 rounded-3xl">Достижений пока нет</div>
            {% endif %}
        </div>
    </div>

    <div class="mt-16" x-data="{ history: [] }" x-init="history = await (await fetch('/api/user/history')).json()">
        <h3 class="text-xl font-black text-white mb-6 flex items-center gap-2">
            <i class="fa-solid fa-clock-rotate-left text-violet-400"></i> История активности
        </h3>
        <div class="rounded-3xl border border-white/5 bg-white/5 overflow-hidden backdrop-blur-md">
            <table class="w-full text-xs text-left">
                <thead class="bg-white/5 text-white/30 uppercase font-black tracking-widest">
                    <tr>
                        <th class="px-6 py-4">Дата</th>
                        <th class="px-6 py-4">Звонки</th>
                        <th class="px-6 py-4">Минуты</th>
                        <th class="px-6 py-4">Конверсия</th>
                        <th class="px-6 py-4 text-right">Сделки</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-white/5 text-white/70">
                    <template x-for="item in history">
                        <tr class="hover:bg-white/5 transition-colors group">
                            <td class="px-6 py-4 font-bold text-white group-hover:text-violet-400 transition-colors" x-text="item.date"></td>
                            <td class="px-6 py-4 font-mono" x-text="item.calls"></td>
                            <td class="px-6 py-4 font-mono" x-text="item.mins"></td>
                            <td class="px-6 py-4 text-emerald-400 font-black" x-text="item.conv + '%'"></td>
                            <td class="px-6 py-4 text-right font-black text-white" x-text="item.won"></td>
                        </tr>
                    </template>
                </tbody>
            </table>
            <div x-show="history.length === 0" class="p-10 text-center text-white/20 uppercase font-black text-[10px] tracking-widest">История пуста</div>
        </div>
    </div>
</div>
{% endblock %}